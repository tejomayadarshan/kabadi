<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kabaddi Live Scoreboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@300;400;500;700&display=swap');
        
        .orbitron { font-family: 'Orbitron', monospace; }
        .roboto { font-family: 'Roboto', sans-serif; }
        
        .glow {
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        }
        
        .pulse-glow {
            animation: pulseGlow 2s infinite;
        }
        
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(239, 68, 68, 0.5); }
            50% { box-shadow: 0 0 30px rgba(239, 68, 68, 0.8); }
        }
        
        .timer-warning {
            animation: timerWarning 0.5s infinite alternate;
        }
        
        @keyframes timerWarning {
            0% { background-color: rgb(239, 68, 68); }
            100% { background-color: rgb(220, 38, 38); }
        }

        .floating-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .live-dot {
            animation: livePulse 1.5s infinite;
        }

        @keyframes livePulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .raid-warning {
            animation: heartbeat 0.8s infinite;
            background: linear-gradient(135deg, rgb(239, 68, 68), rgb(220, 38, 38)) !important;
            box-shadow: 0 0 40px rgba(239, 68, 68, 1) !important;
        }

        @keyframes heartbeat {
            0% { 
                transform: scale(1);
                box-shadow: 0 0 40px rgba(239, 68, 68, 1);
            }
            25% { 
                transform: scale(1.1);
                box-shadow: 0 0 50px rgba(239, 68, 68, 1);
            }
            50% { 
                transform: scale(1);
                box-shadow: 0 0 40px rgba(239, 68, 68, 1);
            }
            75% { 
                transform: scale(1.05);
                box-shadow: 0 0 45px rgba(239, 68, 68, 1);
            }
            100% { 
                transform: scale(1);
                box-shadow: 0 0 40px rgba(239, 68, 68, 1);
            }
        }

        .match-ended {
            animation: matchEndedPulse 2s infinite;
        }

        @keyframes matchEndedPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .allout-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
            animation: alloutAnimation 3s ease-in-out;
        }

        @keyframes alloutAnimation {
            0% { 
                transform: translate(-50%, -50%) scale(0) rotate(0deg);
                opacity: 0;
            }
            20% { 
                transform: translate(-50%, -50%) scale(1.2) rotate(10deg);
                opacity: 1;
            }
            40% { 
                transform: translate(-50%, -50%) scale(1) rotate(-5deg);
                opacity: 1;
            }
            60% { 
                transform: translate(-50%, -50%) scale(1.1) rotate(2deg);
                opacity: 1;
            }
            80% { 
                transform: translate(-50%, -50%) scale(1) rotate(0deg);
                opacity: 1;
            }
            100% { 
                transform: translate(-50%, -50%) scale(0.8) rotate(0deg);
                opacity: 0;
            }
        }

        .coin-flip {
            animation: coinFlip 2s ease-in-out;
        }

        @keyframes coinFlip {
            0% { transform: rotateY(0deg); }
            50% { transform: rotateY(1800deg) scale(1.2); }
            100% { transform: rotateY(3600deg); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 min-h-screen roboto">
    
    <!-- Mode Indicator (Admin Only) -->
    <div id="modeIndicator" class="floating-indicator hidden">
        <div class="bg-green-500/90 backdrop-blur-lg rounded-full px-4 py-2 text-white font-bold text-sm flex items-center gap-2">
            <div class="w-3 h-3 bg-red-500 rounded-full live-dot"></div>
            <span id="modeText">AUDIENCE VIEW</span>
        </div>
    </div>

    <!-- Admin Login Screen -->
    <div id="adminLogin" class="hidden min-h-screen flex items-center justify-center p-4">
        <div class="bg-white/10 backdrop-blur-lg rounded-3xl p-8 max-w-md w-full border border-white/20">
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-white orbitron mb-2">üîê ADMIN ACCESS</h1>
                <p class="text-blue-200">Enter password to access admin controls</p>
            </div>
            
            <div class="space-y-6">
                <div>
                    <label class="block text-white font-medium mb-2">Admin Password</label>
                    <input type="password" id="adminPassword" placeholder="Enter admin password" 
                           class="w-full px-4 py-3 rounded-xl bg-white/20 border border-white/30 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400"
                           onkeypress="if(event.key==='Enter') loginAdmin()">
                </div>
                
                <button onclick="loginAdmin()" 
                        class="w-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 glow">
                    LOGIN AS ADMIN
                </button>
                
                <button onclick="showAudienceView()" 
                        class="w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold py-3 px-6 rounded-xl transition-all duration-300">
                    VIEW AS AUDIENCE
                </button>
            </div>
        </div>
    </div>

    <!-- Match Setup Screen -->
    <div id="setupScreen" class="hidden min-h-screen flex items-center justify-center p-4">
        <div class="bg-white/10 backdrop-blur-lg rounded-3xl p-8 max-w-md w-full border border-white/20">
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-white orbitron mb-2">üèÜ KABADDI</h1>
                <p class="text-blue-200">Match Setup - Admin Mode</p>
            </div>
            
            <div class="space-y-6">
                <div>
                    <label class="block text-white font-medium mb-2">Referee Name</label>
                    <input type="text" id="refereeName" placeholder="Enter referee name" 
                           class="w-full px-4 py-3 rounded-xl bg-white/20 border border-white/30 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400">
                </div>

                <div>
                    <label class="block text-white font-medium mb-2">Team A Name</label>
                    <input type="text" id="teamAName" placeholder="Enter Team A name" 
                           class="w-full px-4 py-3 rounded-xl bg-white/20 border border-white/30 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400">
                </div>
                
                <div>
                    <label class="block text-white font-medium mb-2">Team B Name</label>
                    <input type="text" id="teamBName" placeholder="Enter Team B name" 
                           class="w-full px-4 py-3 rounded-xl bg-white/20 border border-white/30 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400">
                </div>
                
                <div>
                    <label class="block text-white font-medium mb-2">Match Format</label>
                    <select id="matchFormat" onchange="updateMatchDuration()"
                            class="w-full px-4 py-3 rounded-xl bg-slate-800 border border-white/30 text-white focus:outline-none focus:ring-2 focus:ring-blue-400">
                        <option value="20" class="bg-slate-800 text-white">20 min x 2 halves (Standard)</option>
                        <option value="30" class="bg-slate-800 text-white">30 min x 2 halves (Extended)</option>
                        <option value="custom" class="bg-slate-800 text-white">Custom Duration</option>
                    </select>
                </div>
                
                <div id="customDurationDiv" class="hidden">
                    <label class="block text-white font-medium mb-2">Custom Duration (minutes per half)</label>
                    <input type="number" id="customDuration" value="20" min="5" max="45"
                           class="w-full px-4 py-3 rounded-xl bg-white/20 border border-white/30 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400">
                </div>
                
                <div class="space-y-3">
                    <button onclick="setupNextMatch()" 
                            class="w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold py-3 px-6 rounded-xl transition-all duration-300">
                        PREVIEW NEXT MATCH
                    </button>
                    
                    <button onclick="showTossScreen()" 
                            class="w-full bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-bold py-3 px-6 rounded-xl transition-all duration-300">
                        SETUP TEAMS & TOSS
                    </button>
                    
                    <button onclick="startMatch()" 
                            class="w-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 glow">
                        START MATCH
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toss & Team Setup Screen -->
    <div id="tossScreen" class="hidden min-h-screen p-4 overflow-y-auto">
        <div class="max-w-6xl mx-auto">
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-white orbitron mb-2">ü™ô TOSS & TEAM SETUP</h1>
                <p class="text-blue-200">Configure teams, conduct toss, and set player lineups</p>
            </div>

            <!-- Toss Section -->
            <div class="bg-white/10 backdrop-blur-lg rounded-3xl p-8 mb-8 border border-white/20">
                <h2 class="text-2xl font-bold text-yellow-400 orbitron mb-6 text-center">ü™ô TOSS</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 items-center">
                    <div class="text-center">
                        <div class="text-lg font-bold text-red-400 mb-2" id="tossTeamA">TEAM A</div>
                        <button onclick="selectTossChoice('A', 'court')" id="teamACourtBtn" 
                                class="w-full mb-2 px-4 py-2 rounded-lg bg-red-500/30 border border-red-400 text-red-300 font-bold hover:bg-red-500/50 transition-all">
                            CHOOSE COURT
                        </button>
                        <button onclick="selectTossChoice('A', 'raid')" id="teamARaidBtn" 
                                class="w-full px-4 py-2 rounded-lg bg-red-500/30 border border-red-400 text-red-300 font-bold hover:bg-red-500/50 transition-all">
                            CHOOSE TO RAID FIRST
                        </button>
                    </div>
                    
                    <div class="text-center">
                        <div class="text-6xl mb-4" id="coinDisplay">ü™ô</div>
                        <button onclick="flipCoin()" id="flipCoinBtn" 
                                class="bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 text-black font-bold py-4 px-8 rounded-xl transition-all transform hover:scale-105 text-lg">
                            FLIP COIN
                        </button>
                        <div id="tossResult" class="mt-4 text-2xl font-bold text-yellow-400"></div>
                        <div id="tossWinner" class="mt-2 text-lg text-green-400"></div>
                    </div>
                    
                    <div class="text-center">
                        <div class="text-lg font-bold text-blue-400 mb-2" id="tossTeamB">TEAM B</div>
                        <button onclick="selectTossChoice('B', 'court')" id="teamBCourtBtn" 
                                class="w-full mb-2 px-4 py-2 rounded-lg bg-blue-500/30 border border-blue-400 text-blue-300 font-bold hover:bg-blue-500/50 transition-all">
                            CHOOSE COURT
                        </button>
                        <button onclick="selectTossChoice('B', 'raid')" id="teamBRaidBtn" 
                                class="w-full px-4 py-2 rounded-lg bg-blue-500/30 border border-blue-400 text-blue-300 font-bold hover:bg-blue-500/50 transition-all">
                            CHOOSE TO RAID FIRST
                        </button>
                    </div>
                </div>
                
                <div id="tossDecision" class="mt-6 p-4 bg-green-500/20 border border-green-400 rounded-lg text-center hidden">
                    <div class="text-green-400 font-bold text-lg mb-2">TOSS COMPLETED</div>
                    <div id="tossDecisionText" class="text-white"></div>
                </div>
            </div>

            <!-- Team Lineups -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <!-- Team A Lineup -->
                <div class="bg-gradient-to-br from-red-600/20 to-red-800/20 backdrop-blur-lg rounded-3xl p-6 border border-red-500/30">
                    <h3 class="text-2xl font-bold text-red-400 orbitron mb-4 text-center" id="teamALineupTitle">TEAM A LINEUP</h3>
                    
                    <div class="mb-6">
                        <h4 class="text-lg font-bold text-white mb-3">üåü MAIN PLAYERS (7)</h4>
                        <div class="space-y-2">
                            <input type="text" id="teamAMain1" placeholder="Captain (C)" class="w-full px-3 py-2 rounded-lg bg-white/20 border border-red-400 text-white placeholder-red-200 focus:outline-none focus:ring-2 focus:ring-red-400">
                            <input type="text" id="teamAMain2" placeholder="Player 2" class="w-full px-3 py-2 rounded-lg bg-white/20 border border-red-400 text-white placeholder-red-200 focus:outline-none focus:ring-2 focus:ring-red-400">
                            <input type="text" id="teamAMain3" placeholder="Player 3" class="w-full px-3 py-2 rounded-lg bg-white/20 border border-red-400 text-white placeholder-red-200 focus:outline-none focus:ring-2 focus:ring-red-400">
                            <input type="text" id="teamAMain4" placeholder="Player 4" class="w-full px-3 py-2 rounded-lg bg-white/20 border border-red-400 text-white placeholder-red-200 focus:outline-none focus:ring-2 focus:ring-red-400">
                            <input type="text" id="teamAMain5" placeholder="Player 5" class="w-full px-3 py-2 rounded-lg bg-white/20 border border-red-400 text-white placeholder-red-200 focus:outline-none focus:ring-2 focus:ring-red-400">
                            <input type="text" id="teamAMain6" placeholder="Player 6" class="w-full px-3 py-2 rounded-lg bg-white/20 border border-red-400 text-white placeholder-red-200 focus:outline-none focus:ring-2 focus:ring-red-400">
                            <input type="text" id="teamAMain7" placeholder="Player 7" class="w-full px-3 py-2 rounded-lg bg-white/20 border border-red-400 text-white placeholder-red-200 focus:outline-none focus:ring-2 focus:ring-red-400">
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="text-lg font-bold text-white mb-3">üîÑ SUBSTITUTES (5)</h4>
                        <div class="space-y-2">
                            <input type="text" id="teamASub1" placeholder="Substitute 1" class="w-full px-3 py-2 rounded-lg bg-white/10 border border-red-400/50 text-white placeholder-red-300 focus:outline-none focus:ring-2 focus:ring-red-400">
                            <input type="text" id="teamASub2" placeholder="Substitute 2" class="w-full px-3 py-2 rounded-lg bg-white/10 border border-red-400/50 text-white placeholder-red-300 focus:outline-none focus:ring-2 focus:ring-red-400">
                            <input type="text" id="teamASub3" placeholder="Substitute 3" class="w-full px-3 py-2 rounded-lg bg-white/10 border border-red-400/50 text-white placeholder-red-300 focus:outline-none focus:ring-2 focus:ring-red-400">
                            <input type="text" id="teamASub4" placeholder="Substitute 4" class="w-full px-3 py-2 rounded-lg bg-white/10 border border-red-400/50 text-white placeholder-red-300 focus:outline-none focus:ring-2 focus:ring-red-400">
                            <input type="text" id="teamASub5" placeholder="Substitute 5" class="w-full px-3 py-2 rounded-lg bg-white/10 border border-red-400/50 text-white placeholder-red-300 focus:outline-none focus:ring-2 focus:ring-red-400">
                        </div>
                    </div>
                </div>

                <!-- Team B Lineup -->
                <div class="bg-gradient-to-br from-blue-600/20 to-blue-800/20 backdrop-blur-lg rounded-3xl p-6 border border-blue-500/30">
                    <h3 class="text-2xl font-bold text-blue-400 orbitron mb-4 text-center" id="teamBLineupTitle">TEAM B LINEUP</h3>
                    
                    <div class="mb-6">
                        <h4 class="text-lg font-bold text-white mb-3">üåü MAIN PLAYERS (7)</h4>
                        <div class="space-y-2">
                            <input type="text" id="teamBMain1" placeholder="Captain (C)" class="w-full px-3 py-2 rounded-lg bg-white/20 border border-blue-400 text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400">
                            <input type="text" id="teamBMain2" placeholder="Player 2" class="w-full px-3 py-2 rounded-lg bg-white/20 border border-blue-400 text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400">
                            <input type="text" id="teamBMain3" placeholder="Player 3" class="w-full px-3 py-2 rounded-lg bg-white/20 border border-blue-400 text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400">
                            <input type="text" id="teamBMain4" placeholder="Player 4" class="w-full px-3 py-2 rounded-lg bg-white/20 border border-blue-400 text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400">
                            <input type="text" id="teamBMain5" placeholder="Player 5" class="w-full px-3 py-2 rounded-lg bg-white/20 border border-blue-400 text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400">
                            <input type="text" id="teamBMain6" placeholder="Player 6" class="w-full px-3 py-2 rounded-lg bg-white/20 border border-blue-400 text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400">
                            <input type="text" id="teamBMain7" placeholder="Player 7" class="w-full px-3 py-2 rounded-lg bg-white/20 border border-blue-400 text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400">
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="text-lg font-bold text-white mb-3">üîÑ SUBSTITUTES (5)</h4>
                        <div class="space-y-2">
                            <input type="text" id="teamBSub1" placeholder="Substitute 1" class="w-full px-3 py-2 rounded-lg bg-white/10 border border-blue-400/50 text-white placeholder-blue-300 focus:outline-none focus:ring-2 focus:ring-blue-400">
                            <input type="text" id="teamBSub2" placeholder="Substitute 2" class="w-full px-3 py-2 rounded-lg bg-white/10 border border-blue-400/50 text-white placeholder-blue-300 focus:outline-none focus:ring-2 focus:ring-blue-400">
                            <input type="text" id="teamBSub3" placeholder="Substitute 3" class="w-full px-3 py-2 rounded-lg bg-white/10 border border-blue-400/50 text-white placeholder-blue-300 focus:outline-none focus:ring-2 focus:ring-blue-400">
                            <input type="text" id="teamBSub4" placeholder="Substitute 4" class="w-full px-3 py-2 rounded-lg bg-white/10 border border-blue-400/50 text-white placeholder-blue-300 focus:outline-none focus:ring-2 focus:ring-blue-400">
                            <input type="text" id="teamBSub5" placeholder="Substitute 5" class="w-full px-3 py-2 rounded-lg bg-white/10 border border-blue-400/50 text-white placeholder-blue-300 focus:outline-none focus:ring-2 focus:ring-blue-400">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <button onclick="showSetupScreen()" 
                        class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-xl transition-all">
                    ‚Üê BACK TO SETUP
                </button>
                
                <button onclick="previewTeamLineups()" 
                        class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-xl transition-all">
                    PREVIEW LINEUPS
                </button>
                
                <button onclick="proceedToMatch()" 
                        class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-xl transition-all">
                    PROCEED TO MATCH ‚Üí
                </button>
            </div>
        </div>
    </div>

    <!-- Admin Scoreboard Screen -->
    <div id="adminScreen" class="hidden min-h-screen p-4">
        <!-- Header with Team Names -->
        <div class="text-center mb-6">
            <h1 class="text-4xl font-bold text-white orbitron mb-2">
                <span id="teamADisplay" class="text-red-400">TEAM A</span>
                <span class="text-gray-400 mx-4">VS</span>
                <span id="teamBDisplay" class="text-blue-400">TEAM B</span>
            </h1>
            <div class="text-green-400 font-bold">ADMIN CONTROL PANEL</div>
            <div id="refereeDisplay" class="text-yellow-300 text-sm mt-1">Referee: Not Set</div>
        </div>

        <!-- Timers Section -->
        <div class="grid grid-cols-2 gap-6 mb-6">
            <!-- Raid Timer -->
            <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 text-center border border-white/20">
                <div class="text-white mb-4">
                    <div class="text-xl font-bold text-green-400">RAID TIMER</div>
                    <div class="relative inline-block">
                        <svg class="w-32 h-32 transform -rotate-90" viewBox="0 0 100 100">
                            <circle cx="50" cy="50" r="45" stroke="rgba(255,255,255,0.2)" stroke-width="8" fill="none"/>
                            <circle id="raidCircle" cx="50" cy="50" r="45" stroke="#10b981" stroke-width="8" fill="none" 
                                    stroke-dasharray="283" stroke-dashoffset="0" stroke-linecap="round"/>
                        </svg>
                        <div id="raidTimer" class="absolute inset-0 flex items-center justify-center text-4xl font-bold orbitron text-green-400">30</div>
                    </div>
                    <div class="mb-3">
                        <div class="text-sm text-white mb-2 font-medium">Select Raiding Team:</div>
                        <div class="grid grid-cols-2 gap-2">
                            <button id="raidTeamABtn" onclick="selectRaidingTeam('A')" 
                                    class="px-3 py-2 rounded-lg bg-red-500/30 border border-red-400 text-red-300 text-sm font-bold hover:bg-red-500/50 transition-all">
                                TEAM A RAID
                            </button>
                            <button id="raidTeamBBtn" onclick="selectRaidingTeam('B')" 
                                    class="px-3 py-2 rounded-lg bg-blue-500/30 border border-blue-400 text-blue-300 text-sm font-bold hover:bg-blue-500/50 transition-all">
                                TEAM B RAID
                            </button>
                        </div>
                    </div>
                    <div class="flex justify-center gap-2 mt-4">
                        <button onclick="startRaidTimer()" class="bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-lg font-bold text-sm">START</button>
                        <button onclick="pauseResumeRaidTimer()" id="raidPauseBtn" class="bg-yellow-500 hover:bg-yellow-600 text-black px-3 py-2 rounded-lg font-bold text-sm">PAUSE</button>
                        <button onclick="resetRaidTimer()" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg font-bold text-sm">RESET</button>
                    </div>
                </div>
            </div>
            
            <!-- Match Timer -->
            <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 text-center border border-white/20">
                <div class="text-white">
                    <div class="text-xl font-bold text-yellow-400">MATCH TIMER</div>
                    <div id="matchTimer" class="text-5xl font-bold orbitron text-yellow-400 my-4">20:00</div>
                    <div id="halfIndicator" class="text-lg text-blue-200 mb-4">FIRST HALF</div>
                    <div class="flex justify-center gap-2">
                        <button onclick="startMatchTimer()" id="matchStartBtn" class="bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-lg font-bold text-sm">START</button>
                        <button onclick="pauseResumeMatch()" id="matchPauseBtn" class="bg-yellow-500 hover:bg-yellow-600 text-black px-3 py-2 rounded-lg font-bold text-sm">PAUSE</button>
                        <button onclick="resetMatchTimer()" class="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg font-bold text-sm">RESET</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Team Panels Side by Side -->
        <div class="grid grid-cols-2 gap-6 mb-6">
            <!-- Team A Panel -->
            <div class="bg-gradient-to-br from-red-600/20 to-red-800/20 backdrop-blur-lg rounded-2xl p-6 border border-red-500/30">
                <div class="text-center mb-6">
                    <h2 id="teamANameAdmin" class="text-3xl font-bold text-red-400 orbitron mb-2">TEAM A</h2>
                    <div class="text-7xl font-black text-white orbitron glow" id="scoreAAdmin">0</div>
                </div>
                
                <div class="grid grid-cols-2 gap-3 mb-4">
                    <button onclick="addPoint('A', 'raid')" class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-4 rounded-xl transition-all transform hover:scale-105">
                        RAID POINT<br><span class="text-sm">(+1)</span>
                    </button>
                    <button onclick="addPoint('A', 'tackle')" class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-4 rounded-xl transition-all transform hover:scale-105">
                        TACKLE POINT<br><span class="text-sm">(+1)</span>
                    </button>
                    <button onclick="addPoint('A', 'bonus')" class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-4 rounded-xl transition-all transform hover:scale-105">
                        BONUS POINT<br><span class="text-sm">(+1)</span>
                    </button>
                    <button onclick="addAllOut('A')" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-xl transition-all transform hover:scale-105">
                        ALL-OUT<br><span class="text-sm">(+2)</span>
                    </button>
                    <button onclick="addTechnical('A')" class="bg-red-700 hover:bg-red-800 text-white font-bold py-3 px-4 rounded-xl transition-all transform hover:scale-105">
                        TECHNICAL<br><span class="text-sm">(+1)</span>
                    </button>
                    <button onclick="deductPoint('A')" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-4 rounded-xl transition-all transform hover:scale-105">
                        DEDUCT<br><span class="text-sm">(-1)</span>
                    </button>
                </div>
            </div>

            <!-- Team B Panel -->
            <div class="bg-gradient-to-br from-blue-600/20 to-blue-800/20 backdrop-blur-lg rounded-2xl p-6 border border-blue-500/30">
                <div class="text-center mb-6">
                    <h2 id="teamBNameAdmin" class="text-3xl font-bold text-blue-400 orbitron mb-2">TEAM B</h2>
                    <div class="text-7xl font-black text-white orbitron glow" id="scoreBAdmin">0</div>
                </div>
                
                <div class="grid grid-cols-2 gap-3 mb-4">
                    <button onclick="addPoint('B', 'raid')" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-xl transition-all transform hover:scale-105">
                        RAID POINT<br><span class="text-sm">(+1)</span>
                    </button>
                    <button onclick="addPoint('B', 'tackle')" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-xl transition-all transform hover:scale-105">
                        TACKLE POINT<br><span class="text-sm">(+1)</span>
                    </button>
                    <button onclick="addPoint('B', 'bonus')" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-xl transition-all transform hover:scale-105">
                        BONUS POINT<br><span class="text-sm">(+1)</span>
                    </button>
                    <button onclick="addAllOut('B')" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-xl transition-all transform hover:scale-105">
                        ALL-OUT<br><span class="text-sm">(+2)</span>
                    </button>
                    <button onclick="addTechnical('B')" class="bg-blue-700 hover:bg-blue-800 text-white font-bold py-3 px-4 rounded-xl transition-all transform hover:scale-105">
                        TECHNICAL<br><span class="text-sm">(+1)</span>
                    </button>
                    <button onclick="deductPoint('B')" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-4 rounded-xl transition-all transform hover:scale-105">
                        DEDUCT<br><span class="text-sm">(-1)</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Admin Controls -->
        <div class="grid grid-cols-3 gap-6 mb-6">
            <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 border border-white/20">
                <h3 class="text-lg font-bold text-white mb-4">Match Controls</h3>
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="startSecondHalf()" id="secondHalfBtn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg text-sm">START 2ND HALF</button>
                    <button onclick="endMatch()" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-lg text-sm">END MATCH</button>
                    <button onclick="newRaid()" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-4 rounded-lg text-sm">NEW RAID</button>
                    <button onclick="resetScores()" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg text-sm">RESET SCORES</button>
                </div>
            </div>

            <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 border border-white/20">
                <h3 class="text-lg font-bold text-white mb-4">Data Management</h3>
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="undoLastAction()" class="bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded-lg text-sm">UNDO LAST</button>
                    <button onclick="exportData()" class="bg-teal-500 hover:bg-teal-600 text-white font-bold py-2 px-4 rounded-lg text-sm">EXPORT DATA</button>
                    <button onclick="clearHistory()" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg text-sm">CLEAR LOG</button>
                    <button onclick="resetMatch()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg text-sm">RESET MATCH</button>
                </div>
            </div>

            <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 border border-white/20">
                <h3 class="text-lg font-bold text-white mb-4">View Controls</h3>
                <div class="space-y-3">
                    <button onclick="showAudienceView()" class="w-full bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg text-sm">PREVIEW AUDIENCE VIEW</button>
                    <div class="text-center text-green-400 text-sm font-bold">
                        <div class="w-3 h-3 bg-green-500 rounded-full inline-block mr-2 live-dot"></div>
                        LIVE SYNC ACTIVE
                    </div>
                </div>
            </div>
        </div>

        <!-- Match History -->
        <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 border border-white/20">
            <h3 class="text-lg font-bold text-white mb-4 orbitron">MATCH HISTORY & LOG</h3>
            <div id="matchHistory" class="max-h-48 overflow-y-auto space-y-2 bg-black/20 rounded-lg p-4">
                <div class="text-gray-400 text-center py-4">Match history will appear here...</div>
            </div>
        </div>
    </div>

    <!-- Audience View (Default) -->
    <div id="audienceView" class="min-h-screen bg-black flex items-center justify-center p-4">
        <div class="w-full max-w-7xl">
            <!-- Match Ended Screen -->
            <div id="matchEndedScreen" class="hidden text-center">
                <div class="animate-pulse mb-8">
                    <h1 class="text-8xl font-black text-yellow-400 orbitron mb-4 animate-bounce">üèÜ MATCH ENDED</h1>
                    <div id="winnerAnnouncement" class="text-5xl font-bold text-white mb-6"></div>
                    <div id="finalScoreDisplay" class="text-3xl text-gray-300 mb-8"></div>
                </div>
                <div class="text-4xl text-blue-400 font-bold animate-pulse">
                    WAITING FOR NEXT MATCH...
                </div>
            </div>

            <!-- Next Match Preview -->
            <div id="nextMatchPreview" class="hidden text-center">
                <div class="animate-pulse mb-8">
                    <h1 class="text-6xl font-black text-green-400 orbitron mb-4">üî• NEXT MATCH</h1>
                    <div class="text-4xl text-white mb-6">
                        <span id="nextTeamA" class="text-red-400"></span>
                        <span class="text-gray-400 mx-4">VS</span>
                        <span id="nextTeamB" class="text-blue-400"></span>
                    </div>
                </div>
                <div class="text-3xl text-yellow-400 font-bold animate-bounce">
                    WAITING FOR MATCH TO START...
                </div>
            </div>

            <!-- Team Lineups Preview -->
            <div id="teamLineupsPreview" class="hidden">
                <div class="text-center mb-8">
                    <h1 class="text-5xl font-black text-white orbitron mb-4">üìã TEAM LINEUPS</h1>
                    <div class="text-2xl text-white mb-2">
                        <span id="previewTeamA" class="text-red-400"></span>
                        <span class="text-gray-400 mx-4">VS</span>
                        <span id="previewTeamB" class="text-blue-400"></span>
                    </div>
                    <div id="previewReferee" class="text-yellow-300 text-lg">Referee: Not Set</div>
                    <div id="previewTossResult" class="text-green-400 text-lg mt-2"></div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Team A Lineup Preview -->
                    <div class="bg-gradient-to-br from-red-600/30 to-red-800/30 backdrop-blur-lg rounded-3xl p-8 border border-red-500/50">
                        <h2 class="text-3xl font-bold text-red-400 orbitron mb-6 text-center" id="previewTeamAName">TEAM A</h2>
                        
                        <div class="mb-8">
                            <h3 class="text-xl font-bold text-white mb-4 flex items-center justify-center gap-2">
                                üåü MAIN PLAYERS
                            </h3>
                            <div id="teamAMainPreview" class="space-y-3">
                                <!-- Main players will be populated here -->
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-xl font-bold text-white mb-4 flex items-center justify-center gap-2">
                                üîÑ SUBSTITUTES
                            </h3>
                            <div id="teamASubPreview" class="space-y-2">
                                <!-- Substitute players will be populated here -->
                            </div>
                        </div>
                    </div>

                    <!-- Team B Lineup Preview -->
                    <div class="bg-gradient-to-br from-blue-600/30 to-blue-800/30 backdrop-blur-lg rounded-3xl p-8 border border-blue-500/50">
                        <h2 class="text-3xl font-bold text-blue-400 orbitron mb-6 text-center" id="previewTeamBName">TEAM B</h2>
                        
                        <div class="mb-8">
                            <h3 class="text-xl font-bold text-white mb-4 flex items-center justify-center gap-2">
                                üåü MAIN PLAYERS
                            </h3>
                            <div id="teamBMainPreview" class="space-y-3">
                                <!-- Main players will be populated here -->
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-xl font-bold text-white mb-4 flex items-center justify-center gap-2">
                                üîÑ SUBSTITUTES
                            </h3>
                            <div id="teamBSubPreview" class="space-y-2">
                                <!-- Substitute players will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <div class="text-center mt-8">
                    <div class="text-2xl text-yellow-400 font-bold animate-pulse">
                        WAITING FOR MATCH TO START...
                    </div>
                </div>
            </div>

            <!-- Main Header -->
            <div id="liveMatchHeader" class="text-center mb-8">
                <h1 class="text-6xl font-black text-white orbitron mb-4">üèÜ KABADDI MATCH</h1>
                <div class="text-2xl text-gray-300">LIVE SCOREBOARD</div>
                <div class="text-green-400 font-bold mt-2 flex items-center justify-center gap-2">
                    <div class="w-3 h-3 bg-green-500 rounded-full live-dot"></div>
                    LIVE
                </div>
            </div>
            
            <!-- Live Scoreboard -->
            <div id="liveScoreboard" class="grid grid-cols-3 gap-8 mb-8">
                <!-- Team A -->
                <div class="bg-gradient-to-br from-red-600 to-red-800 rounded-3xl p-12 text-center border-4 border-red-400 pulse-glow">
                    <h2 id="audienceTeamA" class="text-5xl font-bold text-white mb-6 orbitron">TEAM A</h2>
                    <div id="audienceScoreA" class="text-[12rem] font-black text-white orbitron leading-none">0</div>
                </div>
                
                <!-- Center Timers -->
                <div class="space-y-6">
                    <!-- Match Timer -->
                    <div class="bg-gradient-to-br from-yellow-600 to-yellow-800 rounded-3xl p-8 text-center border-4 border-yellow-400">
                        <div class="text-white">
                            <div class="text-2xl font-bold text-black mb-2">MATCH TIMER</div>
                            <div id="audienceMatchTimer" class="text-6xl font-black orbitron text-black">20:00</div>
                            <div id="audienceHalf" class="text-xl text-black font-bold mt-2">FIRST HALF</div>
                        </div>
                    </div>
                    
                    <!-- Raid Timer -->
                    <div id="raidTimerContainer" class="bg-gradient-to-br from-green-600 to-green-800 rounded-3xl p-8 text-center border-4 border-green-400 transition-all duration-300">
                        <div class="text-white">
                            <div class="text-2xl font-bold text-black mb-2">RAID TIMER</div>
                            <div id="audienceRaidTimer" class="text-6xl font-black orbitron text-black">30</div>
                            <div id="audienceRaidTeam" class="text-xl font-bold text-black mt-2 bg-white/20 rounded-lg py-2 px-4">WAITING FOR RAID</div>
                        </div>
                    </div>
                </div>
                
                <!-- Team B -->
                <div class="bg-gradient-to-br from-blue-600 to-blue-800 rounded-3xl p-12 text-center border-4 border-blue-400 pulse-glow">
                    <h2 id="audienceTeamB" class="text-5xl font-bold text-white mb-6 orbitron">TEAM B</h2>
                    <div id="audienceScoreB" class="text-[12rem] font-black text-white orbitron leading-none">0</div>
                </div>
            </div>
            

        </div>
    </div>

    <script>
        // Game state with localStorage sync
        let gameState = {
            teamA: { 
                name: 'TEAM A', 
                score: 0, 
                raid: 0, 
                tackle: 0, 
                bonus: 0, 
                allout: 0, 
                technical: 0,
                mainPlayers: [],
                substitutes: []
            },
            teamB: { 
                name: 'TEAM B', 
                score: 0, 
                raid: 0, 
                tackle: 0, 
                bonus: 0, 
                allout: 0, 
                technical: 0,
                mainPlayers: [],
                substitutes: []
            },
            referee: '',
            toss: {
                winner: null,
                choice: null, // 'court' or 'raid'
                completed: false
            },
            matchDuration: 20,
            currentHalf: 1,
            matchTime: 1200, // 20 minutes in seconds
            raidTime: 30,
            matchPaused: true,
            raidPaused: true,
            matchInterval: null,
            raidInterval: null,
            currentRaidingTeam: null,
            history: [],
            isAdmin: false,
            matchStarted: false,
            matchEnded: false,
            nextMatch: null,
            audienceView: 'live', // 'live', 'ended', 'preview', 'lineups'
            showLineups: false
        };

        // Admin password
        const ADMIN_PASSWORD = 'Sohan@2211';

        // Real-time sync variables
        let lastSyncTime = 0;
        let syncInterval = null;

        // Audio context for beep sounds
        let audioContext = null;
        
        function initAudio() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            } catch (e) {
                console.log('Audio not supported');
            }
        }

        function playBeep(frequency = 800, duration = 200) {
            if (!audioContext) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = frequency;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration / 1000);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration / 1000);
        }

        // Initialize app
        function initApp() {
            // Initialize audio
            initAudio();
            
            // Load saved state
            loadGameState();
            
            // Check URL parameters for admin mode
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('admin') === 'true') {
                showAdminLogin();
            } else {
                showAudienceView();
            }

            // Start aggressive sync for real-time updates
            startRealTimeSync();
            
            // Listen for storage events from other tabs/windows
            window.addEventListener('storage', handleStorageChange);
            
            // Enable audio on first user interaction
            document.addEventListener('click', () => {
                if (audioContext && audioContext.state === 'suspended') {
                    audioContext.resume();
                }
            }, { once: true });
        }

        // Enhanced storage functions with timestamps
        function saveGameState() {
            gameState.lastUpdate = Date.now();
            localStorage.setItem('kabaddiGameState', JSON.stringify(gameState));
            localStorage.setItem('kabaddiLastSync', gameState.lastUpdate.toString());
        }

        function loadGameState() {
            const saved = localStorage.getItem('kabaddiGameState');
            if (saved) {
                try {
                    const savedState = JSON.parse(saved);
                    // Only update if this is newer data
                    if (!gameState.lastUpdate || savedState.lastUpdate > gameState.lastUpdate) {
                        const wasAdmin = gameState.isAdmin;
                        const oldMatchInterval = gameState.matchInterval;
                        const oldRaidInterval = gameState.raidInterval;
                        
                        gameState = { ...gameState, ...savedState };
                        gameState.isAdmin = wasAdmin; // Preserve admin status
                        
                        // Restore intervals for admin
                        if (wasAdmin) {
                            gameState.matchInterval = oldMatchInterval;
                            gameState.raidInterval = oldRaidInterval;
                        } else {
                            // Clear intervals for audience
                            gameState.matchInterval = null;
                            gameState.raidInterval = null;
                        }
                        
                        updateAllDisplays();
                        lastSyncTime = savedState.lastUpdate || Date.now();
                    }
                } catch (e) {
                    console.error('Error loading game state:', e);
                }
            }
        }

        function startRealTimeSync() {
            // Clear any existing interval
            if (syncInterval) {
                clearInterval(syncInterval);
            }
            
            // Sync every 500ms for ultra-responsive updates
            syncInterval = setInterval(() => {
                if (!gameState.isAdmin) {
                    const lastSync = localStorage.getItem('kabaddiLastSync');
                    if (lastSync && parseInt(lastSync) > lastSyncTime) {
                        loadGameState();
                    }
                }
            }, 500);
        }

        function handleStorageChange(event) {
            // Handle storage events from other tabs/windows
            if (event.key === 'kabaddiGameState' && !gameState.isAdmin) {
                loadGameState();
            }
        }

        // Authentication
        function loginAdmin() {
            const password = document.getElementById('adminPassword').value;
            if (password === ADMIN_PASSWORD) {
                gameState.isAdmin = true;
                document.getElementById('modeText').textContent = 'ADMIN MODE';
                document.getElementById('modeIndicator').className = 'floating-indicator';
                document.getElementById('modeIndicator').firstElementChild.className = 'bg-red-500/90 backdrop-blur-lg rounded-full px-4 py-2 text-white font-bold text-sm flex items-center gap-2';
                
                if (gameState.matchStarted) {
                    showAdminScreen();
                } else {
                    showSetupScreen();
                }
            } else {
                alert('Incorrect password!');
                document.getElementById('adminPassword').value = '';
            }
        }

        function showAdminLogin() {
            hideAllScreens();
            document.getElementById('adminLogin').classList.remove('hidden');
        }

        function showSetupScreen() {
            hideAllScreens();
            document.getElementById('setupScreen').classList.remove('hidden');
            
            // If setting up after a match ended, prepare for next match
            if (gameState.matchEnded) {
                // Clear previous match data but keep it for preview
                document.getElementById('teamAName').value = '';
                document.getElementById('teamBName').value = '';
            }
        }

        function setupNextMatch() {
            const teamAName = document.getElementById('teamAName').value.trim();
            const teamBName = document.getElementById('teamBName').value.trim();
            
            if (!teamAName || !teamBName) {
                alert('Please enter both team names');
                return;
            }

            // Set up next match preview
            gameState.nextMatch = {
                teamA: teamAName,
                teamB: teamBName
            };
            
            saveGameState();
            alert('Next match teams set! Audience will see the preview. Click "Start Match" when ready to begin.');
        }

        function showAdminScreen() {
            hideAllScreens();
            document.getElementById('adminScreen').classList.remove('hidden');
            updateAllDisplays();
        }

        function showAudienceView() {
            hideAllScreens();
            document.getElementById('audienceView').classList.remove('hidden');
            gameState.isAdmin = false;
            document.getElementById('modeIndicator').classList.add('hidden');
            updateAudienceViewState();
            updateAllDisplays();
        }

        function updateAudienceViewState() {
            const matchEndedScreen = document.getElementById('matchEndedScreen');
            const nextMatchPreview = document.getElementById('nextMatchPreview');
            const teamLineupsPreview = document.getElementById('teamLineupsPreview');
            const liveMatchHeader = document.getElementById('liveMatchHeader');
            const liveScoreboard = document.getElementById('liveScoreboard');

            // Hide all screens first
            matchEndedScreen.classList.add('hidden');
            nextMatchPreview.classList.add('hidden');
            teamLineupsPreview.classList.add('hidden');
            liveMatchHeader.classList.remove('hidden');
            liveScoreboard.classList.remove('hidden');

            if (gameState.matchEnded) {
                // Show match ended screen
                matchEndedScreen.classList.remove('hidden');
                liveMatchHeader.classList.add('hidden');
                liveScoreboard.classList.add('hidden');
                
                const winner = gameState.teamA.score > gameState.teamB.score ? gameState.teamA.name : 
                              gameState.teamB.score > gameState.teamA.score ? gameState.teamB.name : 'TIE MATCH';
                
                document.getElementById('winnerAnnouncement').textContent = `WINNER: ${winner}`;
                document.getElementById('finalScoreDisplay').textContent = 
                    `${gameState.teamA.name}: ${gameState.teamA.score} - ${gameState.teamB.name}: ${gameState.teamB.score}`;
            } else if (gameState.showLineups && !gameState.matchStarted) {
                // Show team lineups preview
                teamLineupsPreview.classList.remove('hidden');
                liveMatchHeader.classList.add('hidden');
                liveScoreboard.classList.add('hidden');
                
                updateTeamLineupsPreview();
            } else if (gameState.nextMatch && !gameState.matchStarted) {
                // Show next match preview
                nextMatchPreview.classList.remove('hidden');
                liveMatchHeader.classList.add('hidden');
                liveScoreboard.classList.add('hidden');
                
                document.getElementById('nextTeamA').textContent = gameState.nextMatch.teamA;
                document.getElementById('nextTeamB').textContent = gameState.nextMatch.teamB;
            }
        }

        function updateTeamLineupsPreview() {
            // Update team names and info
            document.getElementById('previewTeamA').textContent = gameState.teamA.name;
            document.getElementById('previewTeamB').textContent = gameState.teamB.name;
            document.getElementById('previewTeamAName').textContent = gameState.teamA.name;
            document.getElementById('previewTeamBName').textContent = gameState.teamB.name;
            
            // Update referee
            const refereeText = gameState.referee ? `Referee: ${gameState.referee}` : 'Referee: Not Set';
            document.getElementById('previewReferee').textContent = refereeText;
            
            // Update toss result
            if (gameState.toss.completed) {
                const winnerName = gameState[`team${gameState.toss.winner}`].name;
                const choiceText = gameState.toss.choice === 'court' ? 'chose their preferred court' : 'chose to raid first';
                document.getElementById('previewTossResult').textContent = `Toss: ${winnerName} won and ${choiceText}`;
            } else {
                document.getElementById('previewTossResult').textContent = '';
            }
            
            // Update Team A lineup
            const teamAMainDiv = document.getElementById('teamAMainPreview');
            teamAMainDiv.innerHTML = '';
            gameState.teamA.mainPlayers.forEach((player, index) => {
                const playerDiv = document.createElement('div');
                playerDiv.className = 'bg-red-500/20 border border-red-400 rounded-lg p-3 text-center';
                playerDiv.innerHTML = `
                    <div class="text-white font-bold">${index + 1}. ${player}</div>
                    ${index === 0 ? '<div class="text-red-300 text-sm">(Captain)</div>' : ''}
                `;
                teamAMainDiv.appendChild(playerDiv);
            });
            
            const teamASubDiv = document.getElementById('teamASubPreview');
            teamASubDiv.innerHTML = '';
            gameState.teamA.substitutes.forEach((player, index) => {
                const playerDiv = document.createElement('div');
                playerDiv.className = 'bg-red-500/10 border border-red-400/50 rounded-lg p-2 text-center';
                playerDiv.innerHTML = `<div class="text-red-200 text-sm">${player}</div>`;
                teamASubDiv.appendChild(playerDiv);
            });
            
            // Update Team B lineup
            const teamBMainDiv = document.getElementById('teamBMainPreview');
            teamBMainDiv.innerHTML = '';
            gameState.teamB.mainPlayers.forEach((player, index) => {
                const playerDiv = document.createElement('div');
                playerDiv.className = 'bg-blue-500/20 border border-blue-400 rounded-lg p-3 text-center';
                playerDiv.innerHTML = `
                    <div class="text-white font-bold">${index + 1}. ${player}</div>
                    ${index === 0 ? '<div class="text-blue-300 text-sm">(Captain)</div>' : ''}
                `;
                teamBMainDiv.appendChild(playerDiv);
            });
            
            const teamBSubDiv = document.getElementById('teamBSubPreview');
            teamBSubDiv.innerHTML = '';
            gameState.teamB.substitutes.forEach((player, index) => {
                const playerDiv = document.createElement('div');
                playerDiv.className = 'bg-blue-500/10 border border-blue-400/50 rounded-lg p-2 text-center';
                playerDiv.innerHTML = `<div class="text-blue-200 text-sm">${player}</div>`;
                teamBSubDiv.appendChild(playerDiv);
            });
        }

        function hideAllScreens() {
            document.getElementById('adminLogin').classList.add('hidden');
            document.getElementById('setupScreen').classList.add('hidden');
            document.getElementById('tossScreen').classList.add('hidden');
            document.getElementById('adminScreen').classList.add('hidden');
            document.getElementById('audienceView').classList.add('hidden');
        }

        // Match setup
        function updateMatchDuration() {
            const format = document.getElementById('matchFormat').value;
            const customDiv = document.getElementById('customDurationDiv');
            
            if (format === 'custom') {
                customDiv.classList.remove('hidden');
            } else {
                customDiv.classList.add('hidden');
            }
        }

        function showTossScreen() {
            const teamAName = document.getElementById('teamAName').value.trim();
            const teamBName = document.getElementById('teamBName').value.trim();
            const refereeName = document.getElementById('refereeName').value.trim();
            
            if (!teamAName || !teamBName) {
                alert('Please enter both team names first');
                return;
            }

            // Update team names in toss screen
            document.getElementById('tossTeamA').textContent = teamAName;
            document.getElementById('tossTeamB').textContent = teamBName;
            document.getElementById('teamALineupTitle').textContent = `${teamAName} LINEUP`;
            document.getElementById('teamBLineupTitle').textContent = `${teamBName} LINEUP`;

            // Store basic match info
            gameState.teamA.name = teamAName;
            gameState.teamB.name = teamBName;
            gameState.referee = refereeName;

            hideAllScreens();
            document.getElementById('tossScreen').classList.remove('hidden');
        }

        function flipCoin() {
            const coinDisplay = document.getElementById('coinDisplay');
            const flipBtn = document.getElementById('flipCoinBtn');
            const tossResult = document.getElementById('tossResult');
            const tossWinner = document.getElementById('tossWinner');

            // Disable button during animation
            flipBtn.disabled = true;
            flipBtn.textContent = 'FLIPPING...';

            // Add flip animation
            coinDisplay.classList.add('coin-flip');

            setTimeout(() => {
                // Determine winner (50/50 chance)
                const winner = Math.random() < 0.5 ? 'A' : 'B';
                const winnerName = gameState[`team${winner}`].name;
                
                // Show result
                tossResult.textContent = winner === 'A' ? 'HEADS' : 'TAILS';
                tossWinner.textContent = `${winnerName} WINS THE TOSS!`;
                
                gameState.toss.winner = winner;
                
                // Enable choice buttons for winner
                enableTossChoiceButtons(winner);
                
                // Remove animation
                coinDisplay.classList.remove('coin-flip');
                flipBtn.textContent = 'COIN FLIPPED';
                
                saveGameState();
            }, 2000);
        }

        function enableTossChoiceButtons(winner) {
            // Disable all buttons first
            document.getElementById('teamACourtBtn').disabled = true;
            document.getElementById('teamARaidBtn').disabled = true;
            document.getElementById('teamBCourtBtn').disabled = true;
            document.getElementById('teamBRaidBtn').disabled = true;

            // Enable buttons for winner
            if (winner === 'A') {
                document.getElementById('teamACourtBtn').disabled = false;
                document.getElementById('teamARaidBtn').disabled = false;
                document.getElementById('teamACourtBtn').classList.remove('opacity-50');
                document.getElementById('teamARaidBtn').classList.remove('opacity-50');
                document.getElementById('teamBCourtBtn').classList.add('opacity-50');
                document.getElementById('teamBRaidBtn').classList.add('opacity-50');
            } else {
                document.getElementById('teamBCourtBtn').disabled = false;
                document.getElementById('teamBRaidBtn').disabled = false;
                document.getElementById('teamBCourtBtn').classList.remove('opacity-50');
                document.getElementById('teamBRaidBtn').classList.remove('opacity-50');
                document.getElementById('teamACourtBtn').classList.add('opacity-50');
                document.getElementById('teamARaidBtn').classList.add('opacity-50');
            }
        }

        function selectTossChoice(team, choice) {
            if (gameState.toss.winner !== team) {
                alert('Only the toss winner can make this choice!');
                return;
            }

            gameState.toss.choice = choice;
            gameState.toss.completed = true;

            const teamName = gameState[`team${team}`].name;
            const choiceText = choice === 'court' ? 'chose their preferred court' : 'chose to raid first';
            
            document.getElementById('tossDecision').classList.remove('hidden');
            document.getElementById('tossDecisionText').textContent = `${teamName} ${choiceText}`;

            // If they chose to raid first, set the raiding team
            if (choice === 'raid') {
                gameState.currentRaidingTeam = team;
            }

            // Disable all choice buttons
            document.getElementById('teamACourtBtn').disabled = true;
            document.getElementById('teamARaidBtn').disabled = true;
            document.getElementById('teamBCourtBtn').disabled = true;
            document.getElementById('teamBRaidBtn').disabled = true;

            saveGameState();
        }

        function previewTeamLineups() {
            // Collect team lineups
            collectTeamLineups();
            
            if (gameState.teamA.mainPlayers.length === 0 && gameState.teamB.mainPlayers.length === 0) {
                alert('Please add at least some players to preview lineups');
                return;
            }

            gameState.showLineups = true;
            saveGameState();
            alert('Team lineups are now visible to the audience! They can see the player names and match details.');
        }

        function collectTeamLineups() {
            // Collect Team A players
            gameState.teamA.mainPlayers = [];
            gameState.teamA.substitutes = [];
            
            for (let i = 1; i <= 7; i++) {
                const player = document.getElementById(`teamAMain${i}`).value.trim();
                if (player) gameState.teamA.mainPlayers.push(player);
            }
            
            for (let i = 1; i <= 5; i++) {
                const player = document.getElementById(`teamASub${i}`).value.trim();
                if (player) gameState.teamA.substitutes.push(player);
            }

            // Collect Team B players
            gameState.teamB.mainPlayers = [];
            gameState.teamB.substitutes = [];
            
            for (let i = 1; i <= 7; i++) {
                const player = document.getElementById(`teamBMain${i}`).value.trim();
                if (player) gameState.teamB.mainPlayers.push(player);
            }
            
            for (let i = 1; i <= 5; i++) {
                const player = document.getElementById(`teamBSub${i}`).value.trim();
                if (player) gameState.teamB.substitutes.push(player);
            }
        }

        function proceedToMatch() {
            collectTeamLineups();
            
            const format = document.getElementById('matchFormat').value;
            let duration;
            if (format === 'custom') {
                duration = parseInt(document.getElementById('customDuration').value);
            } else {
                duration = parseInt(format);
            }

            // Set match parameters
            gameState.matchDuration = duration;
            gameState.matchTime = duration * 60;
            gameState.matchStarted = true;
            gameState.matchEnded = false;
            gameState.nextMatch = null;
            gameState.currentHalf = 1;
            gameState.history = [];

            // Reset scores but keep team info
            gameState.teamA.score = 0;
            gameState.teamA.raid = 0;
            gameState.teamA.tackle = 0;
            gameState.teamA.bonus = 0;
            gameState.teamA.allout = 0;
            gameState.teamA.technical = 0;

            gameState.teamB.score = 0;
            gameState.teamB.raid = 0;
            gameState.teamB.tackle = 0;
            gameState.teamB.bonus = 0;
            gameState.teamB.allout = 0;
            gameState.teamB.technical = 0;

            // Update team names in raid buttons
            const teamABtn = document.getElementById('raidTeamABtn');
            const teamBBtn = document.getElementById('raidTeamBBtn');
            if (teamABtn && teamBBtn) {
                teamABtn.textContent = `${gameState.teamA.name} RAID`;
                teamBBtn.textContent = `${gameState.teamB.name} RAID`;
            }

            saveGameState();
            showAdminScreen();
            addToHistory('Match started', 'system');
        }

        function startMatch() {
            const teamAName = document.getElementById('teamAName').value.trim();
            const teamBName = document.getElementById('teamBName').value.trim();
            const refereeName = document.getElementById('refereeName').value.trim();
            const format = document.getElementById('matchFormat').value;
            
            let duration;
            if (format === 'custom') {
                duration = parseInt(document.getElementById('customDuration').value);
            } else {
                duration = parseInt(format);
            }

            if (!teamAName || !teamBName) {
                alert('Please enter both team names');
                return;
            }

            // Reset match state for new match
            gameState.teamA = { 
                name: teamAName, 
                score: 0, 
                raid: 0, 
                tackle: 0, 
                bonus: 0, 
                allout: 0, 
                technical: 0,
                mainPlayers: [],
                substitutes: []
            };
            gameState.teamB = { 
                name: teamBName, 
                score: 0, 
                raid: 0, 
                tackle: 0, 
                bonus: 0, 
                allout: 0, 
                technical: 0,
                mainPlayers: [],
                substitutes: []
            };
            gameState.referee = refereeName;
            gameState.matchDuration = duration;
            gameState.matchTime = duration * 60;
            gameState.matchStarted = true;
            gameState.matchEnded = false;
            gameState.nextMatch = null;
            gameState.currentHalf = 1;
            gameState.history = [];
            gameState.showLineups = false;
            gameState.toss = { winner: null, choice: null, completed: false };

            // Update team names in raid buttons
            const teamABtn = document.getElementById('raidTeamABtn');
            const teamBBtn = document.getElementById('raidTeamBBtn');
            if (teamABtn && teamBBtn) {
                teamABtn.textContent = `${teamAName} RAID`;
                teamBBtn.textContent = `${teamBName} RAID`;
            }

            saveGameState();
            showAdminScreen();
            addToHistory('Match started', 'system');
        }

        // Timer functions
        function startMatchTimer() {
            if (gameState.matchInterval) {
                gameState.matchPaused = false;
                document.getElementById('matchPauseBtn').textContent = 'PAUSE';
                document.getElementById('matchStartBtn').textContent = 'RUNNING';
                addToHistory('Match timer resumed', 'system');
                return;
            }
            
            gameState.matchPaused = false;
            document.getElementById('matchPauseBtn').textContent = 'PAUSE';
            document.getElementById('matchStartBtn').textContent = 'RUNNING';
            
            gameState.matchInterval = setInterval(() => {
                if (!gameState.matchPaused && gameState.matchTime > 0) {
                    gameState.matchTime--;
                    updateMatchTimerDisplay();
                    saveGameState();
                    
                    if (gameState.matchTime === 0) {
                        if (gameState.currentHalf === 1) {
                            endFirstHalf();
                        } else {
                            endMatch();
                        }
                    }
                }
            }, 1000);
            
            addToHistory('Match timer started', 'system');
        }

        function selectRaidingTeam(team) {
            gameState.currentRaidingTeam = team;
            
            // Update button styles
            const teamABtn = document.getElementById('raidTeamABtn');
            const teamBBtn = document.getElementById('raidTeamBBtn');
            
            if (team === 'A') {
                teamABtn.className = 'px-3 py-2 rounded-lg bg-red-500 border border-red-400 text-white text-sm font-bold';
                teamBBtn.className = 'px-3 py-2 rounded-lg bg-blue-500/30 border border-blue-400 text-blue-300 text-sm font-bold hover:bg-blue-500/50 transition-all';
            } else {
                teamBBtn.className = 'px-3 py-2 rounded-lg bg-blue-500 border border-blue-400 text-white text-sm font-bold';
                teamABtn.className = 'px-3 py-2 rounded-lg bg-red-500/30 border border-red-400 text-red-300 text-sm font-bold hover:bg-red-500/50 transition-all';
            }
            
            updateRaidingTeamDisplay();
            saveGameState();
        }

        function startRaidTimer() {
            if (!gameState.currentRaidingTeam) {
                alert('Please select which team is raiding first!');
                return;
            }
            
            gameState.raidPaused = false;
            
            if (gameState.raidInterval) {
                clearInterval(gameState.raidInterval);
            }
            
            gameState.raidInterval = setInterval(() => {
                if (!gameState.raidPaused && gameState.raidTime > 0) {
                    gameState.raidTime--;
                    updateRaidTimerDisplay();
                    updateRaidCircle();
                    saveGameState();
                    
                    if (gameState.raidTime <= 6) {
                        document.getElementById('raidTimer').classList.add('timer-warning');
                        document.getElementById('audienceRaidTimer').classList.add('timer-warning');
                        
                        // Add visual warning to audience view
                        const raidContainer = document.getElementById('raidTimerContainer');
                        if (raidContainer) {
                            raidContainer.classList.add('raid-warning');
                        }
                        
                        // Play beep sound for last 6 seconds
                        if (gameState.raidTime <= 6 && gameState.raidTime > 0) {
                            playBeep(1000, 150);
                        }
                    }
                    
                    if (gameState.raidTime === 0) {
                        gameState.raidPaused = true;
                        clearInterval(gameState.raidInterval);
                        gameState.raidInterval = null;
                        // Final beep when time expires
                        playBeep(1500, 300);
                        addToHistory(`Raid time expired - ${gameState[`team${gameState.currentRaidingTeam}`].name} was raiding`, 'system');
                        updateRaidTimerButtonStates();
                    }
                }
            }, 1000);
            
            updateRaidTimerButtonStates();
            addToHistory(`Raid started - ${gameState[`team${gameState.currentRaidingTeam}`].name} is raiding`, 'system');
        }

        function pauseResumeRaidTimer() {
            if (!gameState.raidInterval && gameState.raidTime > 0) {
                // Resume from pause
                startRaidTimer();
                return;
            }
            
            gameState.raidPaused = !gameState.raidPaused;
            updateRaidTimerButtonStates();
            addToHistory(`Raid timer ${gameState.raidPaused ? 'paused' : 'resumed'}`, 'system');
        }

        function updateRaidTimerButtonStates() {
            const raidPauseBtn = document.getElementById('raidPauseBtn');
            
            if (raidPauseBtn) {
                if (gameState.raidInterval && !gameState.raidPaused) {
                    raidPauseBtn.textContent = 'PAUSE';
                    raidPauseBtn.className = 'bg-yellow-500 hover:bg-yellow-600 text-black px-3 py-2 rounded-lg font-bold text-sm';
                } else if (gameState.raidTime > 0) {
                    raidPauseBtn.textContent = 'RESUME';
                    raidPauseBtn.className = 'bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-lg font-bold text-sm';
                } else {
                    raidPauseBtn.textContent = 'PAUSE';
                    raidPauseBtn.className = 'bg-gray-500 text-white px-3 py-2 rounded-lg font-bold text-sm opacity-50 cursor-not-allowed';
                }
            }
        }

        function pauseResumeMatch() {
            gameState.matchPaused = !gameState.matchPaused;
            document.getElementById('matchPauseBtn').textContent = gameState.matchPaused ? 'RESUME' : 'PAUSE';
            document.getElementById('matchStartBtn').textContent = gameState.matchPaused ? 'START' : 'RUNNING';
            addToHistory(`Match ${gameState.matchPaused ? 'paused' : 'resumed'}`, 'system');
        }

        function resetRaidTimer() {
            gameState.raidTime = 30;
            gameState.raidPaused = true;
            gameState.currentRaidingTeam = null;
            document.getElementById('raidTimer').classList.remove('timer-warning');
            document.getElementById('audienceRaidTimer').classList.remove('timer-warning');
            
            // Remove visual warning from audience view
            const raidContainer = document.getElementById('raidTimerContainer');
            if (raidContainer) {
                raidContainer.classList.remove('raid-warning');
            }
            
            // Reset raid team buttons
            const teamABtn = document.getElementById('raidTeamABtn');
            const teamBBtn = document.getElementById('raidTeamBBtn');
            if (teamABtn && teamBBtn) {
                teamABtn.className = 'px-3 py-2 rounded-lg bg-red-500/30 border border-red-400 text-red-300 text-sm font-bold hover:bg-red-500/50 transition-all';
                teamBBtn.className = 'px-3 py-2 rounded-lg bg-blue-500/30 border border-blue-400 text-blue-300 text-sm font-bold hover:bg-blue-500/50 transition-all';
            }
            
            document.getElementById('raidPauseBtn').textContent = 'PAUSE';
            updateRaidTimerDisplay();
            updateRaidCircle();
            updateRaidingTeamDisplay();
            saveGameState();
            addToHistory('Raid timer reset to 30 seconds', 'system');
        }

        function resetMatchTimer() {
            if (confirm('Reset match timer to beginning of current half?')) {
                gameState.matchTime = gameState.matchDuration * 60;
                gameState.matchPaused = true;
                document.getElementById('matchPauseBtn').textContent = 'PAUSE';
                document.getElementById('matchStartBtn').textContent = 'START';
                updateMatchTimerDisplay();
                saveGameState();
                addToHistory('Match timer reset', 'system');
            }
        }

        function newRaid() {
            resetRaidTimer();
            addToHistory('New raid started', 'system');
        }

        // Scoring functions
        function addPoint(team, type) {
            let points = 1;
            let description = '';
            
            switch(type) {
                case 'raid':
                    points = 1;
                    description = 'Raid Point';
                    break;
                case 'tackle':
                    points = 1;
                    description = 'Tackle Point';
                    break;
                case 'bonus':
                    points = 1;
                    description = 'Bonus Point';
                    break;
            }

            gameState[`team${team}`][type] += points;
            gameState[`team${team}`].score += points;
            
            updateAllDisplays();
            saveGameState();
            addToHistory(`${gameState[`team${team}`].name}: +${points} ${description}`, team);
        }

        function addAllOut(team) {
            gameState[`team${team}`].allout += 2;
            gameState[`team${team}`].score += 2;
            
            // Show all-out animation in audience view
            showAllOutAnimation(team);
            
            updateAllDisplays();
            saveGameState();
            addToHistory(`${gameState[`team${team}`].name}: +2 All-Out Points`, team);
        }

        function showAllOutAnimation(team) {
            // Create all-out popup
            const popup = document.createElement('div');
            popup.className = 'allout-popup';
            
            const teamColor = team === 'A' ? 'text-red-400' : 'text-blue-400';
            const teamName = gameState[`team${team}`].name;
            
            popup.innerHTML = `
                <div class="bg-gradient-to-r from-yellow-400 to-orange-500 rounded-3xl p-8 border-4 border-yellow-300 text-center shadow-2xl">
                    <div class="text-6xl font-black text-black orbitron mb-4">üî• ALL OUT! üî•</div>
                    <div class="text-3xl font-bold text-black mb-2">${teamName}</div>
                    <div class="text-2xl font-bold text-black">+2 POINTS</div>
                </div>
            `;
            
            document.body.appendChild(popup);
            
            // Play celebration sound
            playBeep(800, 200);
            setTimeout(() => playBeep(1000, 200), 200);
            setTimeout(() => playBeep(1200, 300), 400);
            
            // Remove popup after animation
            setTimeout(() => {
                if (popup.parentNode) {
                    popup.parentNode.removeChild(popup);
                }
            }, 3000);
        }

        function addTechnical(team) {
            gameState[`team${team}`].technical += 1;
            gameState[`team${team}`].score += 1;
            updateAllDisplays();
            saveGameState();
            addToHistory(`${gameState[`team${team}`].name}: +1 Technical Point`, team);
        }

        function deductPoint(team) {
            if (gameState[`team${team}`].score > 0) {
                gameState[`team${team}`].score -= 1;
                updateAllDisplays();
                saveGameState();
                addToHistory(`${gameState[`team${team}`].name}: -1 Point Deducted`, team);
            } else {
                alert(`Cannot deduct points. ${gameState[`team${team}`].name} already has 0 points.`);
            }
        }

        function undoLastAction() {
            if (gameState.history.length > 0) {
                const lastAction = gameState.history[0];
                
                if (lastAction.team === 'A' || lastAction.team === 'B') {
                    const team = lastAction.team;
                    const action = lastAction.action;
                    
                    if (action.includes('Raid Point')) {
                        gameState[`team${team}`].raid = Math.max(0, gameState[`team${team}`].raid - 1);
                        gameState[`team${team}`].score = Math.max(0, gameState[`team${team}`].score - 1);
                    } else if (action.includes('Tackle Point')) {
                        gameState[`team${team}`].tackle = Math.max(0, gameState[`team${team}`].tackle - 1);
                        gameState[`team${team}`].score = Math.max(0, gameState[`team${team}`].score - 1);
                    } else if (action.includes('Bonus Point')) {
                        gameState[`team${team}`].bonus = Math.max(0, gameState[`team${team}`].bonus - 1);
                        gameState[`team${team}`].score = Math.max(0, gameState[`team${team}`].score - 1);
                    } else if (action.includes('All-Out Points')) {
                        gameState[`team${team}`].allout = Math.max(0, gameState[`team${team}`].allout - 2);
                        gameState[`team${team}`].score = Math.max(0, gameState[`team${team}`].score - 2);
                    } else if (action.includes('Technical Point')) {
                        gameState[`team${team}`].technical = Math.max(0, gameState[`team${team}`].technical - 1);
                        gameState[`team${team}`].score = Math.max(0, gameState[`team${team}`].score - 1);
                    } else if (action.includes('Point Deducted')) {
                        gameState[`team${team}`].score += 1;
                    }
                    
                    gameState.history.shift();
                    updateAllDisplays();
                    saveGameState();
                    addToHistory(`Undid: ${action}`, 'system');
                } else {
                    alert('Cannot undo system actions. Only scoring actions can be undone.');
                }
            } else {
                alert('No actions to undo.');
            }
        }

        // Display update functions
        function updateAllDisplays() {
            updateScoreDisplay();
            updateMatchTimerDisplay();
            updateRaidTimerDisplay();
            updateRaidingTeamDisplay();
            updateRaidCircle();
            updateHistoryDisplay();
            updateTimerButtonStates();
            
            // Update audience view state if not admin
            if (!gameState.isAdmin) {
                updateAudienceViewState();
            }
        }

        function updateScoreDisplay() {
            // Admin view
            const scoreAAdmin = document.getElementById('scoreAAdmin');
            const scoreBAdmin = document.getElementById('scoreBAdmin');
            const teamANameAdmin = document.getElementById('teamANameAdmin');
            const teamBNameAdmin = document.getElementById('teamBNameAdmin');
            
            if (scoreAAdmin) scoreAAdmin.textContent = gameState.teamA.score;
            if (scoreBAdmin) scoreBAdmin.textContent = gameState.teamB.score;
            if (teamANameAdmin) teamANameAdmin.textContent = gameState.teamA.name;
            if (teamBNameAdmin) teamBNameAdmin.textContent = gameState.teamB.name;
            
            // Audience view
            const audienceScoreA = document.getElementById('audienceScoreA');
            const audienceScoreB = document.getElementById('audienceScoreB');
            const audienceTeamA = document.getElementById('audienceTeamA');
            const audienceTeamB = document.getElementById('audienceTeamB');
            
            if (audienceScoreA) audienceScoreA.textContent = gameState.teamA.score;
            if (audienceScoreB) audienceScoreB.textContent = gameState.teamB.score;
            if (audienceTeamA) audienceTeamA.textContent = gameState.teamA.name;
            if (audienceTeamB) audienceTeamB.textContent = gameState.teamB.name;
            
            // Header displays
            const teamADisplay = document.getElementById('teamADisplay');
            const teamBDisplay = document.getElementById('teamBDisplay');
            const refereeDisplay = document.getElementById('refereeDisplay');
            if (teamADisplay) teamADisplay.textContent = gameState.teamA.name;
            if (teamBDisplay) teamBDisplay.textContent = gameState.teamB.name;
            if (refereeDisplay) {
                refereeDisplay.textContent = gameState.referee ? `Referee: ${gameState.referee}` : 'Referee: Not Set';
            }
        }

        function updateMatchTimerDisplay() {
            const minutes = Math.floor(gameState.matchTime / 60);
            const seconds = gameState.matchTime % 60;
            const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            const matchTimer = document.getElementById('matchTimer');
            const audienceMatchTimer = document.getElementById('audienceMatchTimer');
            
            if (matchTimer) matchTimer.textContent = timeString;
            if (audienceMatchTimer) audienceMatchTimer.textContent = timeString;
        }

        function updateRaidTimerDisplay() {
            const raidTimer = document.getElementById('raidTimer');
            const audienceRaidTimer = document.getElementById('audienceRaidTimer');
            
            if (raidTimer) raidTimer.textContent = gameState.raidTime;
            if (audienceRaidTimer) audienceRaidTimer.textContent = gameState.raidTime;
        }

        function updateRaidingTeamDisplay() {
            const audienceRaidTeam = document.getElementById('audienceRaidTeam');
            if (audienceRaidTeam && gameState.currentRaidingTeam) {
                const teamName = gameState[`team${gameState.currentRaidingTeam}`].name;
                const teamColor = gameState.currentRaidingTeam === 'A' ? 'text-red-300' : 'text-blue-300';
                audienceRaidTeam.innerHTML = `<span class="${teamColor}">${teamName} RAIDING</span>`;
            } else if (audienceRaidTeam) {
                audienceRaidTeam.textContent = 'WAITING FOR RAID';
            }
        }

        function updateRaidCircle() {
            const circle = document.getElementById('raidCircle');
            if (circle) {
                const percentage = gameState.raidTime / 30;
                const offset = 283 * (1 - percentage);
                circle.style.strokeDashoffset = offset;
                
                if (gameState.raidTime <= 5) {
                    circle.style.stroke = '#ef4444';
                } else if (gameState.raidTime <= 10) {
                    circle.style.stroke = '#f59e0b';
                } else {
                    circle.style.stroke = '#10b981';
                }
            }
        }

        function updateTimerButtonStates() {
            // Update match timer buttons
            const matchStartBtn = document.getElementById('matchStartBtn');
            const matchPauseBtn = document.getElementById('matchPauseBtn');
            
            if (matchStartBtn && matchPauseBtn) {
                if (gameState.matchInterval && !gameState.matchPaused) {
                    matchStartBtn.textContent = 'RUNNING';
                    matchPauseBtn.textContent = 'PAUSE';
                } else if (gameState.matchInterval && gameState.matchPaused) {
                    matchStartBtn.textContent = 'START';
                    matchPauseBtn.textContent = 'RESUME';
                } else {
                    matchStartBtn.textContent = 'START';
                    matchPauseBtn.textContent = 'PAUSE';
                }
            }
            
            // Update raid timer buttons
            updateRaidTimerButtonStates();
            
            // Update half indicator
            const halfIndicator = document.getElementById('halfIndicator');
            const audienceHalf = document.getElementById('audienceHalf');
            const secondHalfBtn = document.getElementById('secondHalfBtn');
            
            if (halfIndicator) {
                halfIndicator.textContent = gameState.currentHalf === 1 ? 'FIRST HALF' : 'SECOND HALF';
            }
            if (audienceHalf) {
                audienceHalf.textContent = gameState.currentHalf === 1 ? 'FIRST HALF' : 'SECOND HALF';
            }
            if (secondHalfBtn) {
                if (gameState.currentHalf === 2) {
                    secondHalfBtn.textContent = 'SECOND HALF';
                    secondHalfBtn.disabled = true;
                    secondHalfBtn.classList.add('opacity-50', 'cursor-not-allowed');
                } else {
                    secondHalfBtn.textContent = 'START 2ND HALF';
                    secondHalfBtn.disabled = false;
                    secondHalfBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                }
            }
        }

        // History and utility functions
        function addToHistory(action, team) {
            const timestamp = new Date().toLocaleTimeString();
            const entry = {
                time: timestamp,
                action: action,
                team: team,
                matchTime: `${Math.floor(gameState.matchTime / 60)}:${(gameState.matchTime % 60).toString().padStart(2, '0')}`
            };
            
            gameState.history.unshift(entry);
            updateHistoryDisplay();
            saveGameState();
        }

        function updateHistoryDisplay() {
            const historyDiv = document.getElementById('matchHistory');
            if (!historyDiv) return;
            
            if (gameState.history.length === 0) {
                historyDiv.innerHTML = '<div class="text-gray-400 text-center py-4">Match history will appear here...</div>';
                return;
            }
            
            historyDiv.innerHTML = gameState.history.slice(0, 10).map((entry, index) => {
                const teamColor = entry.team === 'A' ? 'text-red-400' : entry.team === 'B' ? 'text-blue-400' : 'text-yellow-400';
                const bgColor = entry.team === 'A' ? 'bg-red-500/10' : entry.team === 'B' ? 'bg-blue-500/10' : 'bg-gray-500/10';
                return `
                    <div class="${bgColor} border-l-4 ${entry.team === 'A' ? 'border-red-400' : entry.team === 'B' ? 'border-blue-400' : 'border-yellow-400'} rounded-lg p-3 mb-2">
                        <div class="flex justify-between items-start">
                            <div>
                                <span class="${teamColor} font-bold text-sm">#${gameState.history.length - index}</span>
                                <span class="text-white font-medium ml-2">${entry.action}</span>
                            </div>
                            <div class="text-gray-400 text-xs text-right">
                                <div>${entry.time}</div>
                                <div class="text-yellow-300">${entry.matchTime}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            historyDiv.scrollTop = 0;
        }

        function startSecondHalf() {
            if (gameState.currentHalf === 1) {
                gameState.currentHalf = 2;
                gameState.matchTime = gameState.matchDuration * 60;
                document.getElementById('halfIndicator').textContent = 'SECOND HALF';
                document.getElementById('audienceHalf').textContent = 'SECOND HALF';
                document.getElementById('secondHalfBtn').textContent = 'SECOND HALF';
                document.getElementById('secondHalfBtn').disabled = true;
                saveGameState();
                addToHistory('Second half started', 'system');
            }
        }

        function endFirstHalf() {
            gameState.matchPaused = true;
            document.getElementById('matchPauseBtn').textContent = 'RESUME';
            addToHistory('First half ended', 'system');
            alert('First half ended! Click "START 2ND HALF" when ready.');
        }

        function endMatch() {
            clearInterval(gameState.matchInterval);
            clearInterval(gameState.raidInterval);
            
            gameState.matchInterval = null;
            gameState.raidInterval = null;
            gameState.matchEnded = true;
            gameState.matchStarted = false;
            
            const winner = gameState.teamA.score > gameState.teamB.score ? gameState.teamA.name : 
                          gameState.teamB.score > gameState.teamA.score ? gameState.teamB.name : 'TIE';
            
            addToHistory(`Match ended - Winner: ${winner}`, 'system');
            saveGameState();
            
            alert(`Match ended!\nFinal Score:\n${gameState.teamA.name}: ${gameState.teamA.score}\n${gameState.teamB.name}: ${gameState.teamB.score}\n\nWinner: ${winner}`);
        }

        function resetScores() {
            if (confirm('Reset all scores to zero?')) {
                gameState.teamA.score = 0;
                gameState.teamA.raid = 0;
                gameState.teamA.tackle = 0;
                gameState.teamA.bonus = 0;
                gameState.teamA.allout = 0;
                gameState.teamA.technical = 0;
                
                gameState.teamB.score = 0;
                gameState.teamB.raid = 0;
                gameState.teamB.tackle = 0;
                gameState.teamB.bonus = 0;
                gameState.teamB.allout = 0;
                gameState.teamB.technical = 0;
                
                updateAllDisplays();
                saveGameState();
                addToHistory('All scores reset to zero', 'system');
            }
        }

        function resetMatch() {
            if (confirm('Are you sure you want to reset the entire match?')) {
                localStorage.removeItem('kabaddiGameState');
                location.reload();
            }
        }

        function clearHistory() {
            if (confirm('Clear match history?')) {
                gameState.history = [];
                updateHistoryDisplay();
                saveGameState();
            }
        }

        function exportData() {
            // Create Excel-compatible CSV data
            let csvContent = "Kabaddi Match Report\n";
            csvContent += `Date:,${new Date().toLocaleDateString()}\n`;
            csvContent += `Time:,${new Date().toLocaleTimeString()}\n\n`;
            
            // Match Summary
            csvContent += "MATCH SUMMARY\n";
            csvContent += `Team A:,${gameState.teamA.name},Score:,${gameState.teamA.score}\n`;
            csvContent += `Team B:,${gameState.teamB.name},Score:,${gameState.teamB.score}\n`;
            csvContent += `Match Duration:,${gameState.matchDuration} minutes per half\n`;
            csvContent += `Current Half:,${gameState.currentHalf === 1 ? 'First Half' : 'Second Half'}\n\n`;
            
            // Detailed Scoring
            csvContent += "DETAILED SCORING\n";
            csvContent += "Category,Team A,Team B\n";
            csvContent += `Raid Points,${gameState.teamA.raid},${gameState.teamB.raid}\n`;
            csvContent += `Tackle Points,${gameState.teamA.tackle},${gameState.teamB.tackle}\n`;
            csvContent += `Bonus Points,${gameState.teamA.bonus},${gameState.teamB.bonus}\n`;
            csvContent += `All-Out Points,${gameState.teamA.allout},${gameState.teamB.allout}\n`;
            csvContent += `Technical Points,${gameState.teamA.technical},${gameState.teamB.technical}\n`;
            csvContent += `Total Score,${gameState.teamA.score},${gameState.teamB.score}\n\n`;
            
            // Match History
            csvContent += "MATCH HISTORY\n";
            csvContent += "Time,Match Time,Action,Team\n";
            gameState.history.forEach(entry => {
                csvContent += `${entry.time},${entry.matchTime},"${entry.action}",${entry.team === 'A' ? gameState.teamA.name : entry.team === 'B' ? gameState.teamB.name : 'System'}\n`;
            });
            
            // Create and download file
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Kabaddi_Match_${gameState.teamA.name}_vs_${gameState.teamB.name}_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
            
            addToHistory('Match data exported to Excel format', 'system');
        }

        // Initialize the app when page loads
        window.addEventListener('load', initApp);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97d0f3a3548225e0',t:'MTc1NzUyODU1Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
